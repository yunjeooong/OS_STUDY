# 30장. 컨디션 변수

병행 프로그램을 제작하는데 락 이외에도 특정 조건의 만족 여부를 검사하는 기법이 존재합니다.

## 30.1 컨디션 변수의 개념과 관련 루틴

쓰레드 실행 시, 특정 조건이 만족될 때까지 대기를 위해 **컨디션 변수(conditional variable)** 를 사용할 수 있습니다.

### 컨디션 변수란?
- 쓰레드 실행에서 특정 조건이 만족되기를 대기하는 큐 자료 구조입니다.
- 조건이 만족될 때까지 쓰레드를 대기 상태로 유지합니다.

### 주요 특성
- 슬립에서 깨어난 프로세스는 리턴하기 전에 락을 재획득해야 합니다.
- 대기상태에서 깨어났어도 락 획득에 실패하면 다시 sleep 상태로 들어갑니다.

## 30.2 생산자/소비자(유한 버퍼) 문제

동기화 문제인 **생산자/소비자(producer/consumer)** 또는 **유한 버퍼(bounded buffer)** 문제에 대해 살펴봅니다.

### 문제 정의
- 생산자 쓰레드: 데이터를 만들어 버퍼에 넣습니다.
- 소비자 쓰레드: 버퍼에서 데이터를 꺼내 사용합니다.
- 유한 버퍼: 공유 자원으로, 경쟁 조건이 발생되지 않도록 동기화가 필요합니다.

### 주요 동기화 이슈
- 버퍼가 가득 찼을 때 생산자는 대기해야 합니다.
- 버퍼가 비었을 때 소비자는 대기해야 합니다.
- 버퍼에 대한 접근은 상호 배제되어야 합니다.

## 30.3 포함 조건(Covering Condition)

다수의 쓰레드가 메모리 공간의 발생을 대기하고 있는 경우, 어떤 쓰레드를 깨워야 할지 선택해야 합니다.

### 해결 방법
- 대기 중인 **모든 쓰레드**에게 시그널을 보냅니다.
- 모든 쓰레드를 대기상태에서 준비상태로 전이시켜 깨웁니다.
- 깨어난 쓰레드들은 조건을 다시 검사합니다:
  - 조건 만족 시: 실행을 계속합니다.
  - 조건 불만족 시: 다시 대기모드로 들어갑니다.

### 장단점
- **장점**: 모든 대기 중인 쓰레드가 깨어나므로 조건을 만족하는 쓰레드가 실행될 수 있습니다.
- **단점**: 불필요하게 많은 쓰레드를 깨우기 때문에 불필요한 문맥 전환이 발생할 수 있습니다.
